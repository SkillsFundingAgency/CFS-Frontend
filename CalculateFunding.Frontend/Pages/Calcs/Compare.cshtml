@page "{calculationId}"
@model CalculateFunding.Frontend.Pages.Calcs.ComparePageModel
@using CalculateFunding.Frontend.Properties
@using CalculateFunding.Frontend.ViewModels.Common
@{
    ViewData["Title"] = "Compare calculations";
}

@section NavBar {
    <partial name="_NavbarPartial" />
}

@section breadcrumb{
    <div class="breadcrumbs">
        <ol>
            <li><a href="/">@BreadcrumbText.CalculateFunding</a></li>
            <li><a href="/specs">@BreadcrumbText.Specifications</a></li>
            <li><a href="/specs/fundinglinestructure/@Model.Specification.Id">@Model.Specification.Name</a></li>
            <li>
                @if (Model.Calculation.CalculationType == CalculationTypeViewModel.Additional)
                {
                    <a href="/calcs/editAdditionalCalculation/@Model.Calculation.Id">@Model.Calculation.Name</a>
                }
                @if (Model.Calculation.CalculationType == CalculationTypeViewModel.Template)
                {
                    <a href="/calcs/editTemplateCalculation/@Model.Calculation.Id">@Model.Calculation.Name</a>
                }
            </li>
            <li>@BreadcrumbText.CalculationVersionHistory</li>
        </ol>
    </div>
}

@section FormBannerLeft{
    <h1 class="hero-title">@Model.Calculation.Name</h1>
}

@section FormBannerRight{

}

<blockquote class="spacing-30">
    Select 2 versions to compare:
</blockquote>

<div class="row compare-container">
    <div class="col-md-12">
        <form method="get" class="form" action="/calcs/diffcalculation/@Model.Calculation.Id" id="compare-calculations-form">
            @if (Model.Calculations != null && Model.Calculations.Any())
            {
                <table class="compare-table table table-condensed" id="calculationVersions">
                    <thead>
                        <tr>
                            <th class="inner-white-right">Status</th>
                            <th class="inner-white-right">Version</th>
                            <th class="inner-white-right">Updated</th>
                            <th>Author</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int rowCount = 0;
                        }
                        @foreach (var calculationVersion in Model.Calculations)
                        {
                             <tr id="calculation-version-compare-row-@rowCount">
                                 <td>
                                     <div class="multiple-choice">
                                         <input id="calculation-version-compare-checkbox-@rowCount" type="checkbox" name="Versions" value="@calculationVersion.Version"/>
                                         <label></label>
                                         @Model.Calculation.PublishStatus.ToString()
                                     </div>
                                 </td>
                                 <td>@calculationVersion.Version</td>
                                 <td>@calculationVersion.Date.ToString(FormatStrings.DateTimeFormatString)</td>
                                 <td>@calculationVersion.Author?.Name</td>
                             </tr>

                             rowCount++;
                        }
                    </tbody>
                </table>
            }
            else
            {
                <div class="warning" id="no-previous-versions-message">There are no previous versions for this calculation!</div>

            }
            <p class="form-submit-container"><button type="submit" class="button" id="compare-button">Compare calculations</button> </p>
            <p>
                @if (Model.Calculation.CalculationType == CalculationTypeViewModel.Additional)
                {
                    <a href="/calcs/editAdditionalCalculation/@Model.Calculation.Id">Back</a>
                } 
                @if (Model.Calculation.CalculationType == CalculationTypeViewModel.Template)
                {
                    <a href="/calcs/editTemplateCalculation/@Model.Calculation.Id">Back</a>
                } 
            </p>
        </form>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        $('#compare-button').prop('disabled', true);

        $('#calculationVersions').on('change', function (e) {
            var checkboxes = $("#calculationVersions input[type='checkbox']");
            var checkedItems = 0;
            checkboxes.each(function (i, checkbox) {
                if (checkbox.checked) {
                    checkedItems++;
                }
            });
            if (checkedItems == 2) {
                $('#compare-button').prop('disabled', null);
            }
            else {
                $('#compare-button').prop('disabled', true);
            }
        });
    </script>
}
